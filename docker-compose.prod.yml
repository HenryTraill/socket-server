version: '2.1'

services:
  logs:
    entrypoint:
    - '/bin/logspout'
    - '${LOGSPOUT_ENDPOINT}'

  nginx:
    build: nginx/prod
    volumes:
    - media:/media:ro
    restart: always
    ports:
    - 443:443
    depends_on:
    - web

  datadog:
    build: datadog
    depends_on:
    - postgres
    - redis
    environment:
     - API_KEY=${DATADOG_API_KEY}
     - TAGS=${SERVER_NAME:-tcsocket}
     - DD_HOSTNAME=${SERVER_NAME:-tcsocket}
    volumes:
     - /var/run/docker.sock:/var/run/docker.sock
     - /proc/mounts:/host/proc/mounts:ro
     - /sys/fs/cgroup:/host/sys/fs/cgroup:ro
